<!DOCTYPE html>
<html>
<head>
    <title>Mapa de Alerta San Javier</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4sY5nS3t4nJ+tE4D0518A6510+711T6/7036495819717"
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-p4sY5nS3t4nJ+tE4D0518A6510+711T6/7036495819717"
            crossorigin=""></script>

    <style>
        #map {
            height: 100vh;
            width: 100vw;
        }
    </style>
</head>
<body>

<div id="map"></div>

<script>
    // Crea el mapa y lo centra en San Javier, Bolivia
    const map = L.map('map').setView([-16.27, -62.50], 9);

    // Agrega el mapa base de OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // Bounding box del municipio de San Javier
    const sanJavierBounds = L.polygon([
        [-16.57697, -62.70447],
        [-15.84114, -62.58499],
        [-16.245, -62.27325],
        [-16.57697, -62.65091]
    ], {color: 'blue', weight: 2, fillOpacity: 0.1}).addTo(map);

    // Fetch de los focos de calor desde la API de NASA FIRMS
    const firmsApiUrl = "https://firms.modaps.eosdis.nasa.gov/api/area/csv?bbox=-62.70447,-16.57697,-62.27325,-15.84114&satellite=VIIRS&timeframe=24h";

    fetch(firmsApiUrl)
        .then(response => response.text())
        .then(csv => {
            const lines = csv.split('\n');
            const headers = lines[0].split(',');

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length === headers.length) {
                    const foco = {};
                    headers.forEach((h, j) => {
                        foco[h.trim()] = values[j].trim();
                    });

                    // Añade un marcador en la ubicación del foco de calor
                    L.circleMarker([foco.latitude, foco.longitude], {
                        radius: 8,
                        color: 'red',
                        fillColor: '#f03',
                        fillOpacity: 0.5
                    }).addTo(map)
                    .bindPopup(`<b>Foco de calor</b><br>Intensidad: ${foco.brightness}<br>Hora: ${foco.acq_time}`);
                }
            }
        });

</script>

</body>
</html>
